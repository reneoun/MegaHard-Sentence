(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function l(n){const e=window.getSelection();if(!e||e.rangeCount===0)return 0;const t=e.getRangeAt(0),r=t.cloneRange();return r.selectNodeContents(n),r.setEnd(t.endContainer,t.endOffset),r.toString().length}function d(n,e){const t=document.createRange(),r=window.getSelection();if(!r)return;const o=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null);let i=0,c;for(;c=o.nextNode();){const a=c.textContent?.length||0;if(i+a>=e){t.setStart(c,e-i),t.collapse(!0),r.removeAllRanges(),r.addRange(t);return}i+=a}t.selectNodeContents(n),t.collapse(!1),r.removeAllRanges(),r.addRange(t)}function u(n){return l(n)===0}function f(n){const e=l(n),t=n.textContent?.length||0;return e===t}function g(n){n.focus(),d(n,0)}function h(n){n.focus(),d(n,n.textContent?.length||0)}class s{static keydownHandler;static createNewPage(){const e=document.querySelector("section[a4]:last-child");if(!e)return;const t=e.cloneNode(!0);e.parentNode?.appendChild(t),t.scrollIntoView({behavior:"smooth"});const r=t.querySelector("div#editor");r&&(r.id=`editor-${Date.now()}`,r.textContent="",this.keydownHandler&&r.addEventListener("keydown",this.keydownHandler),r.focus())}static deletePage(e){const t=e.closest("section[a4]");if(document.querySelectorAll("section[a4]").length<=1||!t)return!1;t.remove();const i=document.querySelector("section[a4]:last-child").querySelector("div[contenteditable]");return i&&i.focus(),!0}static navigateToPreviousPage(e){const r=e.parentElement?.previousElementSibling?.querySelector("div[contenteditable]");return r?(h(r),!0):!1}static navigateToNextPage(e){const r=e.parentElement?.nextElementSibling?.querySelector("div[contenteditable]");return r?(g(r),!0):!1}static isEmpty(e){return!e.textContent?.trim()}static getAllPages(){return Array.from(document.querySelectorAll("section[a4]"))}static getAllEditors(){return Array.from(document.querySelectorAll("div[contenteditable]"))}static setKeydownHandler(e){this.keydownHandler=e}static setupClickFocus(e,t){const r=()=>{t&&t.focus()};e.addEventListener("click",r),e.addEventListener("touchstart",r)}}class y{shortcuts=new Map;constructor(){this.setupDefaultShortcuts()}setupDefaultShortcuts(){this.addShortcut(["Meta","Enter"],()=>{s.createNewPage()})}addShortcut(e,t){const r=e.sort().join("+");this.shortcuts.set(r,t)}removeShortcut(e){const t=e.sort().join("+");this.shortcuts.delete(t)}handleKeyDown(e){const t=[];e.metaKey&&t.push("Meta"),e.ctrlKey&&t.push("Ctrl"),e.altKey&&t.push("Alt"),e.shiftKey&&t.push("Shift"),e.key&&!["Meta","Control","Alt","Shift"].includes(e.key)&&t.push(e.key);const r=t.sort().join("+"),o=this.shortcuts.get(r);if(o){e.preventDefault(),o();return}this.handleEditorNavigation(e)}handleEditorNavigation(e){const t=e.target;if(!(!t||!t.contentEditable)){if(e.key==="Backspace"&&s.isEmpty(t)){s.deletePage(t);return}if((e.key==="ArrowUp"||e.key==="ArrowLeft")&&u(t)){s.navigateToPreviousPage(t)&&e.preventDefault();return}if((e.key==="ArrowDown"||e.key==="ArrowRight")&&f(t)){s.navigateToNextPage(t)&&e.preventDefault();return}}}getRegisteredShortcuts(){return Array.from(this.shortcuts.keys())}}class S{keyboardService;constructor(){this.keyboardService=new y,this.setupApplication()}setupApplication(){document.addEventListener("DOMContentLoaded",()=>{this.initializeEditor()})}initializeEditor(){const e=document.querySelector("div#editor"),t=document.querySelector("section[a4]");if(!e||!t){console.error("Required editor elements not found");return}s.setupClickFocus(t,e);const r=o=>{this.keyboardService.handleKeyDown(o)};s.setKeydownHandler(r),e.addEventListener("keydown",r)}addKeyboardShortcut(e,t){this.keyboardService.addShortcut(e,t)}removeKeyboardShortcut(e){this.keyboardService.removeShortcut(e)}getRegisteredShortcuts(){return this.keyboardService.getRegisteredShortcuts()}createNewPage(){s.createNewPage()}getAllPages(){return s.getAllPages()}getAllEditors(){return s.getAllEditors()}}new S;
